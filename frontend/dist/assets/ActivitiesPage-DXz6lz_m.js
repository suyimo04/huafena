import{d as J,u as K,y as Q,c as W,a as E,t as I,v as g,w as i,n as k,C as X,b as n,s as h,j as _,r as o,D as Y,o as v,f as u,E as r}from"./index-Dmpy0hQc.js";import{i as b}from"./axios-DYop8cuN.js";function Z(){return b.get("/activities")}function ee(s){return b.post("/activities",s)}function te(s,c){return b.post(`/activities/${s}/register`,null,{params:{userId:c}})}function ae(s,c){return b.post(`/activities/${s}/check-in`,null,{params:{userId:c}})}function le(s){return b.post(`/activities/${s}/archive`)}const ne={class:"p-6"},ie={class:"flex items-center justify-between mb-4"},oe={class:"text-sm text-gray-500"},re=J({__name:"ActivitiesPage",setup(s){const c=K(),C=h(()=>["ADMIN","LEADER"].includes(c.role)),p=h(()=>{var a;return(a=c.user)==null?void 0:a.id}),V=_([]),T=_(!1),N={UPCOMING:"即将开始",ONGOING:"进行中",COMPLETED:"已完成",ARCHIVED:"已归档"},M={UPCOMING:"info",ONGOING:"success",COMPLETED:"warning",ARCHIVED:""};function O(a){return N[a]??a}function U(a){return M[a]??"info"}function R(a){return a?a.replace("T"," ").substring(0,16):""}async function f(){T.value=!0;try{const a=await Z();V.value=a.data??[]}catch{V.value=[]}finally{T.value=!1}}const y=_(!1),A=_(!1),l=_({name:"",description:"",eventTime:"",location:""});function $(){l.value={name:"",description:"",eventTime:"",location:""},y.value=!0}async function G(){if(!l.value.name){r.warning("请输入活动名称");return}if(!l.value.eventTime){r.warning("请选择活动时间");return}if(!l.value.location){r.warning("请输入活动地点");return}A.value=!0;try{const a=typeof l.value.eventTime=="string"?l.value.eventTime:new Date(l.value.eventTime).toISOString().substring(0,19);await ee({name:l.value.name,description:l.value.description||void 0,eventTime:a,location:l.value.location,createdBy:p.value}),r.success("活动创建成功"),y.value=!1,await f()}catch{}finally{A.value=!1}}async function B(a){if(p.value)try{await te(a,p.value),r.success("报名成功"),await f()}catch{}}async function H(a){if(p.value)try{await ae(a,p.value),r.success("签到成功"),await f()}catch{}}async function P(a){try{await le(a),r.success("活动已归档"),await f()}catch{}}return Q(()=>{f()}),(a,e)=>{const d=o("el-button"),m=o("el-table-column"),S=o("el-tag"),z=o("el-table"),D=o("el-input"),w=o("el-form-item"),L=o("el-date-picker"),j=o("el-form"),F=o("el-dialog"),q=Y("loading");return v(),W("div",ne,[e[12]||(e[12]=E("h2",{class:"text-xl font-semibold text-gray-800 mb-4"},"活动管理",-1)),E("div",ie,[E("div",oe,"共 "+I(V.value.length)+" 个活动",1),C.value?(v(),g(d,{key:0,type:"primary",onClick:$},{default:i(()=>[...e[6]||(e[6]=[u("创建活动",-1)])]),_:1})):k("",!0)]),X((v(),g(z,{data:V.value,stripe:"",class:"w-full"},{default:i(()=>[n(m,{prop:"name",label:"名称","min-width":"140"}),n(m,{label:"时间",width:"180"},{default:i(({row:t})=>[u(I(R(t.activityTime)),1)]),_:1}),n(m,{prop:"location",label:"地点",width:"140"}),n(m,{prop:"registrationCount",label:"报名人数",width:"100",align:"center"}),n(m,{label:"状态",width:"110",align:"center"},{default:i(({row:t})=>[n(S,{type:U(t.status),size:"small"},{default:i(()=>[u(I(O(t.status)),1)]),_:2},1032,["type"])]),_:1}),n(m,{label:"操作",width:"220",align:"center"},{default:i(({row:t})=>[!C.value&&t.status!=="ARCHIVED"?(v(),g(d,{key:0,size:"small",type:"primary",onClick:x=>B(t.id)},{default:i(()=>[...e[7]||(e[7]=[u("报名",-1)])]),_:1},8,["onClick"])):k("",!0),!C.value&&t.status!=="ARCHIVED"?(v(),g(d,{key:1,size:"small",type:"success",onClick:x=>H(t.id)},{default:i(()=>[...e[8]||(e[8]=[u("签到",-1)])]),_:1},8,["onClick"])):k("",!0),C.value&&t.status!=="ARCHIVED"?(v(),g(d,{key:2,size:"small",type:"warning",onClick:x=>P(t.id)},{default:i(()=>[...e[9]||(e[9]=[u("归档",-1)])]),_:1},8,["onClick"])):k("",!0)]),_:1})]),_:1},8,["data"])),[[q,T.value]]),n(F,{modelValue:y.value,"onUpdate:modelValue":e[5]||(e[5]=t=>y.value=t),title:"创建活动",width:"480px"},{footer:i(()=>[n(d,{onClick:e[4]||(e[4]=t=>y.value=!1)},{default:i(()=>[...e[10]||(e[10]=[u("取消",-1)])]),_:1}),n(d,{type:"primary",loading:A.value,onClick:G},{default:i(()=>[...e[11]||(e[11]=[u("确定",-1)])]),_:1},8,["loading"])]),default:i(()=>[n(j,{model:l.value,"label-width":"80px"},{default:i(()=>[n(w,{label:"名称"},{default:i(()=>[n(D,{modelValue:l.value.name,"onUpdate:modelValue":e[0]||(e[0]=t=>l.value.name=t),placeholder:"请输入活动名称"},null,8,["modelValue"])]),_:1}),n(w,{label:"描述"},{default:i(()=>[n(D,{modelValue:l.value.description,"onUpdate:modelValue":e[1]||(e[1]=t=>l.value.description=t),type:"textarea",rows:3,placeholder:"请输入活动描述"},null,8,["modelValue"])]),_:1}),n(w,{label:"时间"},{default:i(()=>[n(L,{modelValue:l.value.eventTime,"onUpdate:modelValue":e[2]||(e[2]=t=>l.value.eventTime=t),type:"datetime",placeholder:"选择活动时间",style:{width:"100%"}},null,8,["modelValue"])]),_:1}),n(w,{label:"地点"},{default:i(()=>[n(D,{modelValue:l.value.location,"onUpdate:modelValue":e[3]||(e[3]=t=>l.value.location=t),placeholder:"请输入活动地点"},null,8,["modelValue"])]),_:1})]),_:1},8,["model"])]),_:1},8,["modelValue"])])}}});export{re as default};
