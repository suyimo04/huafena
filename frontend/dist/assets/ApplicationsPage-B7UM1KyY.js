import{d as F,y as q,o,c as v,a as y,b as t,w as e,f as l,C as K,v as b,t as d,F as P,x as M,j as I,E as D,r as c,D as Q,m as te,n as w,_ as Z,p as ae,H as le,G as $}from"./index-Dmpy0hQc.js";import{g as ne,a as se,b as ie,c as oe,d as ue,i as ce,e as re,f as de,h as _e,j as pe}from"./application-J3Xs52zM.js";import{a as me}from"./questionnaire-6W5Ac3R0.js";import"./axios-DYop8cuN.js";const fe={class:"public-link-manager"},Ee={class:"flex justify-between items-center mb-4"},Ie={class:"font-mono text-sm"},ve=F({__name:"PublicLinkManager",setup(L){const S=I(!1),R=I([]),V=I([]),g=I(!1),n=I(null),A=I(!1);function C(m){return m?m.replace("T"," ").substring(0,19):""}function E(m){return`${window.location.origin}/public/questionnaire/${m}`}async function p(m){try{await navigator.clipboard.writeText(E(m)),D.success("链接已复制到剪贴板")}catch{D.error("复制失败，请手动复制")}}async function N(){S.value=!0;try{const m=await ne();R.value=m.data}catch{}finally{S.value=!1}}async function x(){try{const m=await me();V.value=m.data}catch{}}async function O(){if(n.value){A.value=!0;try{await se({templateId:n.value}),D.success("公开链接已生成"),g.value=!1,n.value=null,await N()}catch{}finally{A.value=!1}}}return q(()=>{N(),x()}),(m,r)=>{const f=c("el-button"),h=c("el-table-column"),W=c("el-tag"),B=c("el-table"),U=c("el-option"),u=c("el-select"),a=c("el-form-item"),_=c("el-form"),z=c("el-dialog"),T=Q("loading");return o(),v("div",fe,[y("div",Ee,[r[5]||(r[5]=y("h3",{class:"text-lg font-semibold"},"公开问卷链接",-1)),t(f,{type:"primary",onClick:r[0]||(r[0]=i=>g.value=!0)},{default:e(()=>[...r[4]||(r[4]=[l("生成公开链接",-1)])]),_:1})]),K((o(),b(B,{data:R.value,stripe:""},{default:e(()=>[t(h,{prop:"id",label:"ID",width:"70"}),t(h,{prop:"linkToken",label:"链接标识","min-width":"200"},{default:e(({row:i})=>[y("span",Ie,d(i.linkToken),1)]),_:1}),t(h,{prop:"templateId",label:"模板ID",width:"100"}),t(h,{label:"状态",width:"100"},{default:e(({row:i})=>[t(W,{type:i.active?"success":"info",size:"small"},{default:e(()=>[l(d(i.active?"有效":"已失效"),1)]),_:2},1032,["type"])]),_:1}),t(h,{label:"创建时间",width:"180"},{default:e(({row:i})=>[l(d(C(i.createdAt)),1)]),_:1}),t(h,{label:"过期时间",width:"180"},{default:e(({row:i})=>[l(d(i.expiresAt?C(i.expiresAt):"永不过期"),1)]),_:1}),t(h,{label:"操作",width:"120",fixed:"right"},{default:e(({row:i})=>[t(f,{size:"small",onClick:J=>p(i.linkToken)},{default:e(()=>[...r[6]||(r[6]=[l("复制链接",-1)])]),_:1},8,["onClick"])]),_:1})]),_:1},8,["data"])),[[T,S.value]]),t(z,{modelValue:g.value,"onUpdate:modelValue":r[3]||(r[3]=i=>g.value=i),title:"生成公开链接",width:"450px"},{footer:e(()=>[t(f,{onClick:r[2]||(r[2]=i=>g.value=!1)},{default:e(()=>[...r[7]||(r[7]=[l("取消",-1)])]),_:1}),t(f,{type:"primary",loading:A.value,disabled:!n.value,onClick:O},{default:e(()=>[...r[8]||(r[8]=[l(" 生成 ",-1)])]),_:1},8,["loading","disabled"])]),default:e(()=>[t(_,{"label-width":"100px"},{default:e(()=>[t(a,{label:"问卷模板"},{default:e(()=>[t(u,{modelValue:n.value,"onUpdate:modelValue":r[1]||(r[1]=i=>n.value=i),placeholder:"请选择问卷模板",style:{width:"100%"}},{default:e(()=>[(o(!0),v(P,null,M(V.value,i=>(o(),b(U,{key:i.id,label:i.title,value:i.id},null,8,["label","value"]))),128))]),_:1},8,["modelValue"])]),_:1})]),_:1})]),_:1},8,["modelValue"])])}}}),ye={class:"application-timeline"},Re={class:"timeline-card"},ge={class:"timeline-status"},be={class:"timeline-desc"},Ne={key:0,class:"timeline-operator"},Te=F({__name:"ApplicationTimeline",props:{applicationId:{}},setup(L){const S=L,R=I([]),V=I(!1);async function g(p){V.value=!0;try{const N=await ie(p);R.value=N.data??[]}catch{R.value=[]}finally{V.value=!1}}te(()=>S.applicationId,p=>{p?g(p):R.value=[]},{immediate:!0});function n(p){return p?p.replace("T"," ").substring(0,19):""}function A(p){return{PENDING_INITIAL_REVIEW:"warning",INITIAL_REVIEW_PASSED:"success",REJECTED:"danger",AUTO_REJECTED:"danger",AI_INTERVIEW_IN_PROGRESS:"primary",PENDING_REVIEW:"warning",INTERN_OFFERED:"success",INTERNSHIP_IN_PROGRESS:"primary",MEMBER_CONVERTED:"success"}[p]||"info"}function C(p){return{PENDING_INITIAL_REVIEW:"warning",INITIAL_REVIEW_PASSED:"success",REJECTED:"danger",AUTO_REJECTED:"danger",AI_INTERVIEW_IN_PROGRESS:"",PENDING_REVIEW:"warning",INTERN_OFFERED:"success",INTERNSHIP_IN_PROGRESS:"",MEMBER_CONVERTED:"success"}[p]||"info"}function E(p){return{PENDING_INITIAL_REVIEW:"待初审",INITIAL_REVIEW_PASSED:"初审通过",REJECTED:"已拒绝",AUTO_REJECTED:"自动筛选拒绝",AI_INTERVIEW_IN_PROGRESS:"AI面试中",PENDING_REVIEW:"待复审",INTERN_OFFERED:"已发实习邀请",INTERNSHIP_IN_PROGRESS:"实习中",CONVERSION_REVIEW:"转正评审中",MEMBER_CONVERTED:"已转正"}[p]||p}return(p,N)=>{const x=c("el-tag"),O=c("el-timeline-item"),m=c("el-timeline"),r=c("el-empty");return o(),v("div",ye,[R.value.length>0?(o(),b(m,{key:0},{default:e(()=>[(o(!0),v(P,null,M(R.value,f=>(o(),b(O,{key:f.id,timestamp:n(f.createdAt),type:A(f.status),hollow:!1,placement:"top"},{default:e(()=>[y("div",Re,[y("div",ge,[t(x,{type:C(f.status),size:"small"},{default:e(()=>[l(d(E(f.status)),1)]),_:2},1032,["type"])]),y("div",be,d(f.description),1),f.operator?(o(),v("div",Ne," 操作人: "+d(f.operator),1)):w("",!0)])]),_:2},1032,["timestamp","type"]))),128))]),_:1})):(o(),b(r,{key:1,description:"暂无流程记录"}))])}}}),we=Z(Te,[["__scopeId","data-v-379e2f05"]]),Ae={class:"applications-page"},ke={class:"batch-bar"},he={class:"selected-count"},De={class:"batch-bar-right"},Se={key:0},Ve={key:1,class:"text-gray-400"},Ce={key:0,class:"mt-4"},xe={class:"mt-4"},Oe={key:1,class:"mt-4 flex justify-end gap-2"},Pe=F({__name:"ApplicationsPage",setup(L){const S=I("applications"),R=I(!1),V=I([]),g=I(!1),n=I(null),A=I(null),C=I([]),E=I([]);function p(u){C.value=u,E.value=u.map(a=>a.id)}function N(u){return{PENDING_INITIAL_REVIEW:"warning",INITIAL_REVIEW_PASSED:"success",REJECTED:"danger",AUTO_REJECTED:"danger",AI_INTERVIEW_IN_PROGRESS:"",PENDING_REVIEW:"warning",INTERN_OFFERED:"success",INTERNSHIP_IN_PROGRESS:"",MEMBER_CONVERTED:"success"}[u]||"info"}function x(u){return{PENDING_INITIAL_REVIEW:"待初审",INITIAL_REVIEW_PASSED:"初审通过",REJECTED:"已拒绝",AUTO_REJECTED:"自动筛选拒绝",AI_INTERVIEW_IN_PROGRESS:"AI面试中",PENDING_REVIEW:"待复审",INTERN_OFFERED:"已发实习邀请",INTERNSHIP_IN_PROGRESS:"实习中",CONVERSION_REVIEW:"转正评审中",MEMBER_CONVERTED:"已转正"}[u]||u}function O(u){return u?u.replace("T"," ").substring(0,19):""}async function m(){R.value=!0;try{const u=await oe();V.value=u.data}catch{}finally{R.value=!1}}async function r(u){if(n.value=u,A.value=null,g.value=!0,u.questionnaireResponseId)try{const a=await ue(u.questionnaireResponseId);A.value=JSON.parse(a.data.answers)}catch{}}async function f(u,a){const _=a?"通过":"拒绝";try{await $.confirm(`确定${_}该申请？`,"确认操作",{confirmButtonText:"确定",cancelButtonText:"取消",type:a?"success":"warning"})}catch{return}try{await ce(u.id,{approved:a}),D.success(`已${_}`),g.value=!1,await m()}catch{}}async function h(){if(E.value.length!==0){try{await $.confirm(`确定批量通过 ${E.value.length} 条申请？`,"批量通过",{confirmButtonText:"确定",cancelButtonText:"取消",type:"success"})}catch{return}try{await re(E.value),D.success("批量通过成功"),await m()}catch{}}}async function W(){if(E.value.length!==0){try{await $.confirm(`确定批量拒绝 ${E.value.length} 条申请？`,"批量拒绝",{confirmButtonText:"确定",cancelButtonText:"取消",type:"warning"})}catch{return}try{await de(E.value),D.success("批量拒绝成功"),await m()}catch{}}}async function B(){if(E.value.length!==0){try{await $.confirm(`确定向 ${E.value.length} 位申请者发送面试通知？`,"批量发送面试通知",{confirmButtonText:"确定",cancelButtonText:"取消",type:"info"})}catch{return}try{await _e(E.value),D.success("面试通知已发送"),await m()}catch{}}}async function U(){try{const u=await pe(),a=window.URL.createObjectURL(u),_=document.createElement("a");_.href=a,_.download=`applications_${new Date().toISOString().slice(0,10)}.xlsx`,document.body.appendChild(_),_.click(),document.body.removeChild(_),window.URL.revokeObjectURL(a),D.success("导出成功")}catch{D.error("导出失败")}}return q(m),(u,a)=>{const _=c("el-button"),z=c("el-icon"),T=c("el-table-column"),i=c("el-tag"),J=c("el-table"),k=c("el-descriptions-item"),j=c("el-descriptions"),X=c("el-dialog"),H=c("el-tab-pane"),Y=c("el-tabs"),ee=Q("loading");return o(),v("div",Ae,[a[16]||(a[16]=y("div",{class:"page-header"},[y("h2",{class:"page-title"},"申请管理")],-1)),t(Y,{modelValue:S.value,"onUpdate:modelValue":a[3]||(a[3]=s=>S.value=s)},{default:e(()=>[t(H,{label:"申请列表",name:"applications"},{default:e(()=>[y("div",ke,[E.value.length>0?(o(),v(P,{key:0},[y("span",he,"已选 "+d(E.value.length)+" 项",1),t(_,{type:"success",size:"small",onClick:h},{default:e(()=>[...a[4]||(a[4]=[l(" 批量通过 ",-1)])]),_:1}),t(_,{type:"danger",size:"small",onClick:W},{default:e(()=>[...a[5]||(a[5]=[l(" 批量拒绝 ",-1)])]),_:1}),t(_,{type:"primary",size:"small",onClick:B},{default:e(()=>[...a[6]||(a[6]=[l(" 批量发送面试通知 ",-1)])]),_:1})],64)):w("",!0),y("div",De,[t(_,{type:"primary",plain:"",size:"small",onClick:U},{default:e(()=>[t(z,{class:"mr-1"},{default:e(()=>[t(ae(le))]),_:1}),a[7]||(a[7]=l(" 导出 Excel ",-1))]),_:1})])]),K((o(),b(J,{data:V.value,stripe:"",class:"app-table",onSelectionChange:p},{default:e(()=>[t(T,{type:"selection",width:"50"}),t(T,{prop:"id",label:"ID",width:"70"}),t(T,{prop:"userId",label:"申请者ID",width:"100"}),t(T,{label:"入口类型",width:"120"},{default:e(({row:s})=>[l(d(s.entryType==="REGISTRATION"?"注册":"公开链接"),1)]),_:1}),t(T,{label:"中高考",width:"90"},{default:e(({row:s})=>[s.examFlag?(o(),b(i,{key:0,type:"danger",size:"small",effect:"dark",class:"exam-tag"},{default:e(()=>[l(d(s.examType==="GAOKAO"?"高考":s.examType==="ZHONGKAO"?"中考":"备考"),1)]),_:2},1024)):w("",!0)]),_:1}),t(T,{label:"问卷摘要","min-width":"180"},{default:e(({row:s})=>[s.questionnaireResponseId?(o(),v("span",Se," 问卷回答 #"+d(s.questionnaireResponseId),1)):(o(),v("span",Ve,"无"))]),_:1}),t(T,{label:"状态",width:"160"},{default:e(({row:s})=>[t(i,{type:N(s.status),size:"small"},{default:e(()=>[l(d(x(s.status)),1)]),_:2},1032,["type"])]),_:1}),t(T,{label:"创建时间",width:"180",sortable:"",prop:"createdAt"},{default:e(({row:s})=>[l(d(O(s.createdAt)),1)]),_:1}),t(T,{label:"操作",width:"200",fixed:"right"},{default:e(({row:s})=>[t(_,{size:"small",onClick:G=>r(s)},{default:e(()=>[...a[8]||(a[8]=[l("查看详情",-1)])]),_:1},8,["onClick"]),s.status==="PENDING_INITIAL_REVIEW"?(o(),v(P,{key:0},[t(_,{size:"small",type:"success",onClick:G=>f(s,!0)},{default:e(()=>[...a[9]||(a[9]=[l("通过",-1)])]),_:1},8,["onClick"]),t(_,{size:"small",type:"danger",onClick:G=>f(s,!1)},{default:e(()=>[...a[10]||(a[10]=[l("拒绝",-1)])]),_:1},8,["onClick"])],64)):w("",!0)]),_:1})]),_:1},8,["data"])),[[ee,R.value]]),t(X,{modelValue:g.value,"onUpdate:modelValue":a[2]||(a[2]=s=>g.value=s),title:"申请详情",width:"700px"},{default:e(()=>[n.value?(o(),v(P,{key:0},[t(j,{column:2,border:""},{default:e(()=>[t(k,{label:"申请ID"},{default:e(()=>[l(d(n.value.id),1)]),_:1}),t(k,{label:"申请者ID"},{default:e(()=>[l(d(n.value.userId),1)]),_:1}),t(k,{label:"入口类型"},{default:e(()=>[l(d(n.value.entryType==="REGISTRATION"?"注册":"公开链接"),1)]),_:1}),t(k,{label:"状态"},{default:e(()=>[t(i,{type:N(n.value.status),size:"small"},{default:e(()=>[l(d(x(n.value.status)),1)]),_:1},8,["type"])]),_:1}),n.value.pollenUid?(o(),b(k,{key:0,label:"花粉UID"},{default:e(()=>[l(d(n.value.pollenUid),1)]),_:1})):w("",!0),n.value.calculatedAge!=null?(o(),b(k,{key:1,label:"年龄"},{default:e(()=>[l(d(n.value.calculatedAge),1)]),_:1})):w("",!0),n.value.examFlag?(o(),b(k,{key:2,label:"中高考状态"},{default:e(()=>[t(i,{type:"danger",size:"small",effect:"dark"},{default:e(()=>[l(d(n.value.examType==="GAOKAO"?"高考":"中考"),1)]),_:1})]),_:1})):w("",!0),n.value.needsAttention?(o(),b(k,{key:3,label:"重点审核"},{default:e(()=>[t(i,{type:"warning",size:"small"},{default:e(()=>[...a[11]||(a[11]=[l("需关注",-1)])]),_:1})]),_:1})):w("",!0),t(k,{label:"创建时间",span:2},{default:e(()=>[l(d(O(n.value.createdAt)),1)]),_:1})]),_:1}),A.value?(o(),v("div",Ce,[a[12]||(a[12]=y("h4",{class:"mb-2 font-medium"},"问卷回答",-1)),t(j,{column:1,border:""},{default:e(()=>[(o(!0),v(P,null,M(A.value,(s,G)=>(o(),b(k,{key:G,label:String(G)},{default:e(()=>[l(d(typeof s=="object"?JSON.stringify(s):String(s)),1)]),_:2},1032,["label"]))),128))]),_:1})])):w("",!0),y("div",xe,[a[13]||(a[13]=y("h4",{class:"mb-2 font-medium"},"流程时间线",-1)),t(we,{"application-id":n.value.id},null,8,["application-id"])]),n.value.status==="PENDING_INITIAL_REVIEW"?(o(),v("div",Oe,[t(_,{type:"success",onClick:a[0]||(a[0]=s=>f(n.value,!0))},{default:e(()=>[...a[14]||(a[14]=[l("通过",-1)])]),_:1}),t(_,{type:"danger",onClick:a[1]||(a[1]=s=>f(n.value,!1))},{default:e(()=>[...a[15]||(a[15]=[l("拒绝",-1)])]),_:1})])):w("",!0)],64)):w("",!0)]),_:1},8,["modelValue"])]),_:1}),t(H,{label:"公开链接",name:"publicLinks"},{default:e(()=>[t(ve)]),_:1})]),_:1},8,["modelValue"])])}}}),Be=Z(Pe,[["__scopeId","data-v-ad21b08c"]]);export{Be as default};
