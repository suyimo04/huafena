import{d as O,m as z,c as y,a as p,b as a,w as t,e as M,f as m,r as u,o as _,t as q,n as x,F as H,p as R,q as I,j as V,k as P,s as h,E as C,g as G,_ as K}from"./index-Dmpy0hQc.js";import{i as Q}from"./axios-DYop8cuN.js";import{c as W}from"./formHelpers-BLIiThDM.js";const L={class:"register-page"},B={class:"register-card theme-card"},j={key:0,class:"age-display"},Z={class:"questionnaire-placeholder"},$={class:"questionnaire-area"},J={class:"register-footer"},X=O({__name:"RegisterPage",setup(ee){const E=G(),g=V(),s=V(!1),l=P({username:"",password:"",confirmPassword:"",pollenUid:"",birthDate:"",educationStage:"",examFlag:!1,examType:"",examDate:"",weeklyAvailableDays:3,dailyAvailableHours:2,weeklyAvailableSlots:[]}),b=h(()=>l.birthDate?W(l.birthDate):null);function A(n){return n.getTime()>Date.now()}z(()=>l.examFlag,n=>{n||(l.examType="",l.examDate="")});const U={username:[{required:!0,message:"请输入用户名",trigger:"blur"},{min:2,max:20,message:"用户名长度为 2-20 个字符",trigger:"blur"}],password:[{required:!0,message:"请输入密码",trigger:"blur"},{min:6,max:50,message:"密码长度为 6-50 个字符",trigger:"blur"}],confirmPassword:[{required:!0,message:"请确认密码",trigger:"blur"},{validator:(n,e,r)=>{e!==l.password?r(new Error("两次输入的密码不一致")):r()},trigger:"blur"}],pollenUid:[{required:!0,validator:(n,e,r)=>{if(!e){r(new Error("请输入花粉 UID（QQ号）"));return}if(!/^[1-9]\d{4,10}$/.test(e)){r(new Error("QQ号格式不正确，需为5-11位纯数字且首位不为0"));return}r()},trigger:"blur"}],birthDate:[{required:!0,message:"请选择出生日期",trigger:"change"}],educationStage:[{required:!0,message:"请选择教育阶段",trigger:"change"}],examType:[{validator:(n,e,r)=>{l.examFlag&&!e?r(new Error("请选择考试类型")):r()},trigger:"change"}],examDate:[{validator:(n,e,r)=>{l.examFlag&&!e?r(new Error("请选择考试日期")):r()},trigger:"change"}],weeklyAvailableDays:[{required:!0,message:"请填写每周可用天数",trigger:"change"}],dailyAvailableHours:[{required:!0,message:"请填写每日可用时长",trigger:"change"}],weeklyAvailableSlots:[{required:!0,message:"请选择至少一个可用时段",trigger:"change",type:"array",min:1}]};async function w(){if(!(!g.value||!await g.value.validate().catch(()=>!1))){s.value=!0;try{await Q.post("/auth/register",{username:l.username,password:l.password,pollenUid:l.pollenUid,birthDate:l.birthDate,educationStage:l.educationStage,examFlag:l.examFlag,examType:l.examFlag?l.examType:null,examDate:l.examFlag?l.examDate:null,weeklyAvailableDays:l.weeklyAvailableDays,dailyAvailableHours:l.dailyAvailableHours,weeklyAvailableSlots:l.weeklyAvailableSlots}),C.success("注册成功，请等待审核后登录"),E.push("/login")}catch{}finally{s.value=!1}}}return(n,e)=>{const r=u("el-input"),d=u("el-form-item"),v=u("el-divider"),D=u("el-date-picker"),k=u("el-tag"),i=u("el-option"),f=u("el-select"),N=u("el-checkbox"),c=u("el-input-number"),S=u("el-icon"),Y=u("el-button"),T=u("el-form"),F=u("router-link");return _(),y("div",L,[p("div",B,[e[20]||(e[20]=p("h2",{class:"register-title"},"注册新账户",-1)),e[21]||(e[21]=p("p",{class:"register-subtitle"},"填写信息以申请加入花粉小组",-1)),a(T,{ref_key:"formRef",ref:g,model:l,rules:U,"label-position":"top",onSubmit:M(w,["prevent"])},{default:t(()=>[a(d,{label:"用户名",prop:"username"},{default:t(()=>[a(r,{modelValue:l.username,"onUpdate:modelValue":e[0]||(e[0]=o=>l.username=o),placeholder:"请输入用户名","prefix-icon":"User",size:"large",disabled:s.value},null,8,["modelValue","disabled"])]),_:1}),a(d,{label:"密码",prop:"password"},{default:t(()=>[a(r,{modelValue:l.password,"onUpdate:modelValue":e[1]||(e[1]=o=>l.password=o),type:"password",placeholder:"请输入密码","prefix-icon":"Lock",size:"large","show-password":"",disabled:s.value},null,8,["modelValue","disabled"])]),_:1}),a(d,{label:"确认密码",prop:"confirmPassword"},{default:t(()=>[a(r,{modelValue:l.confirmPassword,"onUpdate:modelValue":e[2]||(e[2]=o=>l.confirmPassword=o),type:"password",placeholder:"请再次输入密码","prefix-icon":"Lock",size:"large","show-password":"",disabled:s.value},null,8,["modelValue","disabled"])]),_:1}),a(v,null,{default:t(()=>[...e[12]||(e[12]=[m("申请信息",-1)])]),_:1}),a(d,{label:"花粉 UID（QQ号）",prop:"pollenUid"},{default:t(()=>[a(r,{modelValue:l.pollenUid,"onUpdate:modelValue":e[3]||(e[3]=o=>l.pollenUid=o),placeholder:"请输入QQ号（5-11位纯数字）",size:"large",disabled:s.value},null,8,["modelValue","disabled"])]),_:1}),a(d,{label:"出生年月",prop:"birthDate"},{default:t(()=>[a(D,{modelValue:l.birthDate,"onUpdate:modelValue":e[4]||(e[4]=o=>l.birthDate=o),type:"date",placeholder:"请选择出生日期",format:"YYYY-MM-DD","value-format":"YYYY-MM-DD",size:"large",disabled:s.value,"disabled-date":A,style:{width:"100%"}},null,8,["modelValue","disabled"])]),_:1}),b.value!==null?(_(),y("div",j,[a(k,{type:b.value<18?"danger":"success",size:"small"},{default:t(()=>[m(" 当前年龄："+q(b.value)+" 岁 ",1)]),_:1},8,["type"])])):x("",!0),a(d,{label:"教育阶段",prop:"educationStage"},{default:t(()=>[a(f,{modelValue:l.educationStage,"onUpdate:modelValue":e[5]||(e[5]=o=>l.educationStage=o),placeholder:"请选择教育阶段",size:"large",disabled:s.value,style:{width:"100%"}},{default:t(()=>[a(i,{label:"初中",value:"MIDDLE_SCHOOL"}),a(i,{label:"高中",value:"HIGH_SCHOOL"}),a(i,{label:"大学",value:"UNIVERSITY"}),a(i,{label:"研究生",value:"GRADUATE"}),a(i,{label:"非学生",value:"NON_STUDENT"})]),_:1},8,["modelValue","disabled"])]),_:1}),a(d,null,{default:t(()=>[a(N,{modelValue:l.examFlag,"onUpdate:modelValue":e[6]||(e[6]=o=>l.examFlag=o),disabled:s.value},{default:t(()=>[...e[13]||(e[13]=[m(" 即将参加中考或高考 ",-1)])]),_:1},8,["modelValue","disabled"])]),_:1}),l.examFlag?(_(),y(H,{key:1},[a(d,{label:"考试类型",prop:"examType"},{default:t(()=>[a(f,{modelValue:l.examType,"onUpdate:modelValue":e[7]||(e[7]=o=>l.examType=o),placeholder:"请选择考试类型",size:"large",disabled:s.value,style:{width:"100%"}},{default:t(()=>[a(i,{label:"中考",value:"ZHONGKAO"}),a(i,{label:"高考",value:"GAOKAO"})]),_:1},8,["modelValue","disabled"])]),_:1}),a(d,{label:"考试日期",prop:"examDate"},{default:t(()=>[a(D,{modelValue:l.examDate,"onUpdate:modelValue":e[8]||(e[8]=o=>l.examDate=o),type:"date",placeholder:"请选择考试日期",format:"YYYY-MM-DD","value-format":"YYYY-MM-DD",size:"large",disabled:s.value,style:{width:"100%"}},null,8,["modelValue","disabled"])]),_:1})],64)):x("",!0),a(v,null,{default:t(()=>[...e[14]||(e[14]=[m("可用性承诺",-1)])]),_:1}),a(d,{label:"每周可用天数",prop:"weeklyAvailableDays"},{default:t(()=>[a(c,{modelValue:l.weeklyAvailableDays,"onUpdate:modelValue":e[9]||(e[9]=o=>l.weeklyAvailableDays=o),min:1,max:7,size:"large",disabled:s.value,style:{width:"100%"}},null,8,["modelValue","disabled"])]),_:1}),a(d,{label:"每日可用时长（小时）",prop:"dailyAvailableHours"},{default:t(()=>[a(c,{modelValue:l.dailyAvailableHours,"onUpdate:modelValue":e[10]||(e[10]=o=>l.dailyAvailableHours=o),min:.5,max:24,step:.5,precision:1,size:"large",disabled:s.value,style:{width:"100%"}},null,8,["modelValue","disabled"])]),_:1}),a(d,{label:"每周可用时段",prop:"weeklyAvailableSlots"},{default:t(()=>[a(f,{modelValue:l.weeklyAvailableSlots,"onUpdate:modelValue":e[11]||(e[11]=o=>l.weeklyAvailableSlots=o),multiple:"",placeholder:"请选择可用时段",size:"large",disabled:s.value,style:{width:"100%"}},{default:t(()=>[a(i,{label:"工作日上午 (9:00-12:00)",value:"WEEKDAY_MORNING"}),a(i,{label:"工作日下午 (13:00-18:00)",value:"WEEKDAY_AFTERNOON"}),a(i,{label:"工作日晚上 (19:00-22:00)",value:"WEEKDAY_EVENING"}),a(i,{label:"周末上午 (9:00-12:00)",value:"WEEKEND_MORNING"}),a(i,{label:"周末下午 (13:00-18:00)",value:"WEEKEND_AFTERNOON"}),a(i,{label:"周末晚上 (19:00-22:00)",value:"WEEKEND_EVENING"})]),_:1},8,["modelValue","disabled"])]),_:1}),p("div",Z,[a(v,null,{default:t(()=>[...e[15]||(e[15]=[m("申请问卷",-1)])]),_:1}),p("div",$,[a(S,{size:"32",color:"#9ca3af"},{default:t(()=>[a(R(I))]),_:1}),e[16]||(e[16]=p("p",null,"问卷将在此处加载",-1))])]),a(d,null,{default:t(()=>[a(Y,{type:"primary",size:"large",class:"register-btn",loading:s.value,onClick:w},{default:t(()=>[...e[17]||(e[17]=[m(" 注册 ",-1)])]),_:1},8,["loading"])]),_:1})]),_:1},8,["model"]),p("div",J,[e[19]||(e[19]=m(" 已有账户？ ",-1)),a(F,{to:"/login",class:"link-accent"},{default:t(()=>[...e[18]||(e[18]=[m("返回登录",-1)])]),_:1})])])])}}}),ie=K(X,[["__scopeId","data-v-17403fec"]]);export{ie as default};
