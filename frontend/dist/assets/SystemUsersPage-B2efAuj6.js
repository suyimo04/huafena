import{i as g}from"./axios-DYop8cuN.js";import{d as H,y as J,c as N,a as R,b as t,w as n,C as K,v as Q,j as p,r as o,D as W,o as V,f as u,t as C,F as X,x as Y,k as Z,E as f,G as ee}from"./index-Dmpy0hQc.js";function le(){return g.get("/admin/users")}function ae(i){return g.post("/admin/users",i)}function k(i,b){return g.put(`/admin/users/${i}`,b)}function te(i){return g.delete(`/admin/users/${i}`)}const ne={class:"p-6"},se={class:"flex items-center justify-between mb-4"},ie=H({__name:"SystemUsersPage",setup(i){const b=p([]),w=p(!1),d=p(!1),r=p(!1),v=p(null),y=p(!1),e=Z({username:"",password:"",role:"MEMBER",enabled:!0}),x=[{value:"ADMIN",label:"管理员"},{value:"LEADER",label:"组长"},{value:"VICE_LEADER",label:"副组长"},{value:"MEMBER",label:"正式成员"},{value:"INTERN",label:"实习成员"},{value:"APPLICANT",label:"申请者"}],I={ADMIN:"管理员",LEADER:"组长",VICE_LEADER:"副组长",MEMBER:"正式成员",INTERN:"实习成员",APPLICANT:"申请者"};function L(s){return I[s]??s}function B(s){return{ADMIN:"danger",LEADER:"warning",VICE_LEADER:"",MEMBER:"success",INTERN:"info",APPLICANT:"info"}[s]??"info"}async function _(){w.value=!0;try{const s=await le();b.value=s.data??[]}catch{}finally{w.value=!1}}function U(){r.value=!1,v.value=null,e.username="",e.password="",e.role="MEMBER",e.enabled=!0,d.value=!0}function T(s){r.value=!0,v.value=s.id,e.username=s.username,e.password="",e.role=s.role,e.enabled=s.enabled,d.value=!0}async function h(){y.value=!0;try{if(r.value&&v.value)await k(v.value,{role:e.role,enabled:String(e.enabled),password:e.password||void 0}),f.success("用户更新成功");else{if(!e.username||!e.password){f.warning("用户名和密码不能为空");return}await ae({username:e.username,password:e.password,role:e.role,enabled:String(e.enabled)}),f.success("用户创建成功")}d.value=!1,await _()}catch{}finally{y.value=!1}}async function P(s){try{await k(s.id,{enabled:String(!s.enabled)}),f.success(s.enabled?"已禁用":"已启用"),await _()}catch{}}async function S(s){try{await ee.confirm(`确定要删除用户 "${s.username}" 吗？`,"确认删除",{type:"warning"})}catch{return}try{await te(s.id),f.success("删除成功"),await _()}catch{}}return J(_),(s,a)=>{const m=o("el-button"),c=o("el-table-column"),A=o("el-tag"),$=o("el-table"),D=o("el-input"),E=o("el-form-item"),z=o("el-option"),j=o("el-select"),F=o("el-switch"),O=o("el-form"),G=o("el-dialog"),q=W("loading");return V(),N("div",ne,[R("div",se,[a[7]||(a[7]=R("h2",{class:"text-xl font-semibold text-gray-800"},"用户管理",-1)),t(m,{type:"primary",onClick:U},{default:n(()=>[...a[6]||(a[6]=[u("新增用户",-1)])]),_:1})]),K((V(),Q($,{data:b.value,stripe:"",class:"w-full"},{default:n(()=>[t(c,{prop:"id",label:"ID",width:"80"}),t(c,{prop:"username",label:"用户名",width:"160"}),t(c,{prop:"role",label:"角色",width:"140"},{default:n(({row:l})=>[t(A,{type:B(l.role),size:"small"},{default:n(()=>[u(C(L(l.role)),1)]),_:2},1032,["type"])]),_:1}),t(c,{label:"状态",width:"100"},{default:n(({row:l})=>[t(A,{type:l.enabled?"success":"info",size:"small"},{default:n(()=>[u(C(l.enabled?"启用":"禁用"),1)]),_:2},1032,["type"])]),_:1}),t(c,{prop:"createdAt",label:"创建时间",width:"180"}),t(c,{label:"操作","min-width":"200"},{default:n(({row:l})=>[t(m,{size:"small",onClick:M=>T(l)},{default:n(()=>[...a[8]||(a[8]=[u("编辑",-1)])]),_:1},8,["onClick"]),t(m,{size:"small",type:l.enabled?"warning":"success",onClick:M=>P(l)},{default:n(()=>[u(C(l.enabled?"禁用":"启用"),1)]),_:2},1032,["type","onClick"]),t(m,{size:"small",type:"danger",onClick:M=>S(l)},{default:n(()=>[...a[9]||(a[9]=[u("删除",-1)])]),_:1},8,["onClick"])]),_:1})]),_:1},8,["data"])),[[q,w.value]]),t(G,{modelValue:d.value,"onUpdate:modelValue":a[5]||(a[5]=l=>d.value=l),title:r.value?"编辑用户":"新增用户",width:"480px"},{footer:n(()=>[t(m,{onClick:a[4]||(a[4]=l=>d.value=!1)},{default:n(()=>[...a[10]||(a[10]=[u("取消",-1)])]),_:1}),t(m,{type:"primary",onClick:h,loading:y.value},{default:n(()=>[...a[11]||(a[11]=[u("确定",-1)])]),_:1},8,["loading"])]),default:n(()=>[t(O,{model:e,"label-width":"80px"},{default:n(()=>[t(E,{label:"用户名"},{default:n(()=>[t(D,{modelValue:e.username,"onUpdate:modelValue":a[0]||(a[0]=l=>e.username=l),disabled:r.value,placeholder:"请输入用户名"},null,8,["modelValue","disabled"])]),_:1}),t(E,{label:"密码"},{default:n(()=>[t(D,{modelValue:e.password,"onUpdate:modelValue":a[1]||(a[1]=l=>e.password=l),type:"password","show-password":"",placeholder:r.value?"留空则不修改":"请输入密码"},null,8,["modelValue","placeholder"])]),_:1}),t(E,{label:"角色"},{default:n(()=>[t(j,{modelValue:e.role,"onUpdate:modelValue":a[2]||(a[2]=l=>e.role=l),placeholder:"选择角色",class:"w-full"},{default:n(()=>[(V(),N(X,null,Y(x,l=>t(z,{key:l.value,label:l.label,value:l.value},null,8,["label","value"])),64))]),_:1},8,["modelValue"])]),_:1}),t(E,{label:"状态"},{default:n(()=>[t(F,{modelValue:e.enabled,"onUpdate:modelValue":a[3]||(a[3]=l=>e.enabled=l),"active-text":"启用","inactive-text":"禁用"},null,8,["modelValue"])]),_:1})]),_:1},8,["model"])]),_:1},8,["modelValue","title"])])}}});export{ie as default};
