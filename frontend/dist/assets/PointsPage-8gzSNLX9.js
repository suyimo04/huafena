import{d as X,u as J,y as Q,c as w,a as n,t as v,b as t,w as o,i as W,n as Z,C as ee,v as le,s as M,j as d,r as u,D as te,o as b,f as m,F as S,x as H,a6 as ae,E as U}from"./index-Dmpy0hQc.js";import{i as T}from"./axios-DYop8cuN.js";function oe(i){return T.get(`/points/records/${i}`)}function se(i){return T.get(`/points/total/${i}`)}function ne(i){return T.post("/points/add",i)}function ue(i){return T.post("/points/deduct",i)}const de={class:"p-6"},ie={class:"grid grid-cols-1 md:grid-cols-3 gap-4 mb-6"},re={class:"stats-card bg-white/80 rounded-xl border border-gray-100 shadow-sm p-4"},pe={class:"text-2xl font-bold text-emerald-600"},ve={class:"stats-card bg-white/80 rounded-xl border border-gray-100 shadow-sm p-4"},me={class:"text-2xl font-bold text-emerald-600"},ce={class:"stats-card bg-white/80 rounded-xl border border-gray-100 shadow-sm p-4"},fe={class:"text-2xl font-bold text-emerald-600"},be={class:"flex items-center justify-between mb-4 flex-wrap gap-2"},_e={class:"flex items-center gap-2"},ye={key:0},Ve=X({__name:"PointsPage",setup(i){const k=J(),I=[{value:"COMMUNITY_ACTIVITY",label:"社群活跃度"},{value:"CHECKIN",label:"签到奖惩"},{value:"VIOLATION_HANDLING",label:"处理违规"},{value:"TASK_COMPLETION",label:"完成任务"},{value:"ANNOUNCEMENT",label:"发布公告"},{value:"EVENT_HOSTING",label:"举办活动"},{value:"BIRTHDAY_BONUS",label:"生日福利"},{value:"MONTHLY_EXCELLENT",label:"月度优秀"}],$=Object.fromEntries(I.map(a=>[a.value,a.label]));function h(a){return $[a]??a}function K(a){return a?a.replace("T"," ").substring(0,19):""}const _=M(()=>{var a;return(a=k.user)==null?void 0:a.id}),Y=M(()=>["ADMIN","LEADER"].includes(k.role)),r=d(void 0),y=d(""),g=d([]),N=d(0),C=d(!1),P=M(()=>y.value?g.value.filter(a=>a.pointsType===y.value):g.value);async function x(){const a=r.value??_.value;if(a){C.value=!0;try{const[e,p]=await Promise.all([oe(a),se(a)]);g.value=e.data??[],N.value=p.data??0}catch{g.value=[],N.value=0}finally{C.value=!1}}}const c=d(!1),E=d("add"),D=d(!1),s=d({userId:1,pointsType:"",amount:1,description:""});function A(a){E.value=a,s.value={userId:r.value??1,pointsType:"",amount:1,description:""},c.value=!0}async function j(){if(!s.value.pointsType){U.warning("请选择积分类型");return}D.value=!0;try{const a={userId:s.value.userId,pointsType:s.value.pointsType,amount:s.value.amount,description:s.value.description};E.value==="add"?(await ne(a),U.success("积分增加成功")):(await ue(a),U.success("积分扣减成功")),c.value=!1,(r.value===s.value.userId||!r.value&&_.value===s.value.userId)&&await x()}catch{}finally{D.value=!1}}return Q(()=>{_.value&&(r.value=_.value,x())}),(a,e)=>{const p=u("el-button"),O=u("el-input"),L=u("el-option"),R=u("el-select"),f=u("el-table-column"),F=u("el-table"),B=u("el-input-number"),V=u("el-form-item"),G=u("el-form"),q=u("el-dialog"),z=te("loading");return b(),w("div",de,[e[18]||(e[18]=n("h2",{class:"text-xl font-semibold text-gray-800 mb-4"},"积分管理",-1)),n("div",ie,[n("div",re,[e[10]||(e[10]=n("div",{class:"text-sm text-gray-500"},"查询用户ID",-1)),n("div",pe,v(r.value??"-"),1)]),n("div",ve,[e[11]||(e[11]=n("div",{class:"text-sm text-gray-500"},"总积分",-1)),n("div",me,v(N.value),1)]),n("div",ce,[e[12]||(e[12]=n("div",{class:"text-sm text-gray-500"},"记录数",-1)),n("div",fe,v(P.value.length),1)])]),n("div",be,[n("div",_e,[t(O,{modelValue:r.value,"onUpdate:modelValue":e[0]||(e[0]=l=>r.value=l),modelModifiers:{number:!0},placeholder:"输入用户ID查询",style:{width:"180px"},onKeyup:W(x,["enter"])},{append:o(()=>[t(p,{onClick:x},{default:o(()=>[...e[13]||(e[13]=[m("查询",-1)])]),_:1})]),_:1},8,["modelValue"]),t(R,{modelValue:y.value,"onUpdate:modelValue":e[1]||(e[1]=l=>y.value=l),placeholder:"类型筛选",clearable:"",style:{width:"160px"}},{default:o(()=>[(b(),w(S,null,H(I,l=>t(L,{key:l.value,label:l.label,value:l.value},null,8,["label","value"])),64))]),_:1},8,["modelValue"])]),Y.value?(b(),w("div",ye,[t(p,{type:"primary",onClick:e[2]||(e[2]=l=>A("add"))},{default:o(()=>[...e[14]||(e[14]=[m("增加积分",-1)])]),_:1}),t(p,{type:"danger",onClick:e[3]||(e[3]=l=>A("deduct"))},{default:o(()=>[...e[15]||(e[15]=[m("扣减积分",-1)])]),_:1})])):Z("",!0)]),ee((b(),le(F,{data:P.value,stripe:"",class:"w-full"},{default:o(()=>[t(f,{prop:"userId",label:"用户ID",width:"100"}),t(f,{label:"类型",width:"140"},{default:o(({row:l})=>[m(v(h(l.pointsType)),1)]),_:1}),t(f,{label:"数额",width:"100"},{default:o(({row:l})=>[n("span",{class:ae(l.amount>=0?"text-emerald-600":"text-red-500")},v(l.amount>=0?"+":"")+v(l.amount),3)]),_:1}),t(f,{prop:"description",label:"描述"}),t(f,{label:"时间",width:"180"},{default:o(({row:l})=>[m(v(K(l.createdAt)),1)]),_:1})]),_:1},8,["data"])),[[z,C.value]]),t(q,{modelValue:c.value,"onUpdate:modelValue":e[9]||(e[9]=l=>c.value=l),title:E.value==="add"?"增加积分":"扣减积分",width:"420px"},{footer:o(()=>[t(p,{onClick:e[8]||(e[8]=l=>c.value=!1)},{default:o(()=>[...e[16]||(e[16]=[m("取消",-1)])]),_:1}),t(p,{type:"primary",loading:D.value,onClick:j},{default:o(()=>[...e[17]||(e[17]=[m("确定",-1)])]),_:1},8,["loading"])]),default:o(()=>[t(G,{model:s.value,"label-width":"80px"},{default:o(()=>[t(V,{label:"用户ID"},{default:o(()=>[t(B,{modelValue:s.value.userId,"onUpdate:modelValue":e[4]||(e[4]=l=>s.value.userId=l),min:1,style:{width:"100%"}},null,8,["modelValue"])]),_:1}),t(V,{label:"积分类型"},{default:o(()=>[t(R,{modelValue:s.value.pointsType,"onUpdate:modelValue":e[5]||(e[5]=l=>s.value.pointsType=l),placeholder:"选择类型",style:{width:"100%"}},{default:o(()=>[(b(),w(S,null,H(I,l=>t(L,{key:l.value,label:l.label,value:l.value},null,8,["label","value"])),64))]),_:1},8,["modelValue"])]),_:1}),t(V,{label:"数额"},{default:o(()=>[t(B,{modelValue:s.value.amount,"onUpdate:modelValue":e[6]||(e[6]=l=>s.value.amount=l),min:1,style:{width:"100%"}},null,8,["modelValue"])]),_:1}),t(V,{label:"描述"},{default:o(()=>[t(O,{modelValue:s.value.description,"onUpdate:modelValue":e[7]||(e[7]=l=>s.value.description=l),type:"textarea",rows:2},null,8,["modelValue"])]),_:1})]),_:1},8,["model"])]),_:1},8,["modelValue","title"])])}}});export{Ve as default};
