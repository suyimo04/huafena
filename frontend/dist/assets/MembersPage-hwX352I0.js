import{i as y}from"./axios-DYop8cuN.js";import{d as Y,y as Z,c as v,a as o,b as a,w as t,j as u,r as f,o as n,f as i,C as E,v as m,t as P,F as U,x as j,n as ee,s as te,k as le,E as _,G as ae,D as se}from"./index-Dmpy0hQc.js";function G(){return y.post("/member-rotation/check-promotion")}function S(){return y.post("/member-rotation/check-demotion")}function ne(){return y.post("/member-rotation/trigger-review")}function oe(z){return y.post("/member-rotation/execute",z)}function ie(){return y.post("/member-rotation/mark-dismissal")}function $(){return y.get("/member-rotation/pending-dismissal")}const re={class:"p-6"},de={class:"flex items-center gap-2 mb-4"},ue={key:0,class:"text-green-600 text-sm"},me={key:1,class:"text-red-500 text-sm"},ce={key:2,class:"text-gray-400 text-sm"},fe={class:"flex items-center gap-2 mb-4"},pe={class:"grid grid-cols-1 md:grid-cols-2 gap-4 mb-4"},be={key:0,class:"mt-4 p-4 bg-gray-50 rounded-lg border"},ge={class:"flex items-end gap-4 flex-wrap"},ve={class:"flex items-center gap-2 mb-4"},xe=Y({__name:"MembersPage",setup(z){const N=u("members"),p=u([]),b=u([]),x=u(!1),w=u(!1),q=te(()=>{const s=new Map;for(const e of p.value)s.set(e.id,e);for(const e of b.value)s.set(e.id,e);for(const e of k.value)s.set(e.id,e);return Array.from(s.values())});function H(s){return p.value.some(e=>e.id===s)}function J(s){return b.value.some(e=>e.id===s)}function K(s){return{ADMIN:"danger",LEADER:"warning",VICE_LEADER:"",MEMBER:"success",INTERN:"info",APPLICANT:"info"}[s]??"info"}async function L(){x.value=!0;try{const[s,e,g]=await Promise.all([G(),S(),$()]);p.value=s.data??[],b.value=e.data??[],k.value=g.data??[]}catch{}finally{x.value=!1}}const V=u(!1),h=u(!1),r=le({internId:null,memberId:null});async function T(){w.value=!0;try{const[s,e]=await Promise.all([G(),S()]);p.value=s.data??[],b.value=e.data??[]}catch{}finally{w.value=!1}}async function O(){V.value=!0;try{(await ne()).data?_.success("转正评议已触发"):_.warning("当前不满足转正评议条件"),await T()}catch{}finally{V.value=!1}}async function Q(){if(!(!r.internId||!r.memberId)){try{await ae.confirm("确定要执行角色流转吗？实习成员将转正，对应正式成员将降为实习。","确认流转",{type:"warning"})}catch{return}h.value=!0;try{await oe({internId:r.internId,memberId:r.memberId}),_.success("角色流转执行成功"),r.internId=null,r.memberId=null,await T()}catch{}finally{h.value=!1}}}const k=u([]),I=u(!1),M=u(!1);async function A(){I.value=!0;try{const s=await $();k.value=s.data??[]}catch{}finally{I.value=!1}}async function W(){M.value=!0;try{const e=(await ie()).data??[];e.length>0?_.success(`已标记 ${e.length} 名成员为待开除`):_.info("当前没有需要标记的成员"),await A()}catch{}finally{M.value=!1}}return Z(()=>{L()}),(s,e)=>{const g=f("el-button"),d=f("el-table-column"),c=f("el-tag"),D=f("el-table"),R=f("el-tab-pane"),B=f("el-option"),F=f("el-select"),X=f("el-tabs"),C=se("loading");return n(),v("div",re,[e[17]||(e[17]=o("h2",{class:"text-xl font-semibold text-gray-800 mb-4"},"成员管理与流转",-1)),a(X,{modelValue:N.value,"onUpdate:modelValue":e[2]||(e[2]=l=>N.value=l)},{default:t(()=>[a(R,{label:"成员列表",name:"members"},{default:t(()=>[o("div",de,[a(g,{onClick:L,loading:x.value},{default:t(()=>[...e[3]||(e[3]=[i("刷新",-1)])]),_:1},8,["loading"])]),E((n(),m(D,{data:q.value,stripe:"",class:"w-full"},{default:t(()=>[a(d,{prop:"username",label:"用户名",width:"160"}),a(d,{prop:"role",label:"角色",width:"140"},{default:t(({row:l})=>[a(c,{type:K(l.role),size:"small"},{default:t(()=>[i(P(l.role),1)]),_:2},1032,["type"])]),_:1}),a(d,{label:"状态",width:"140"},{default:t(({row:l})=>[l.pendingDismissal?(n(),m(c,{key:0,type:"danger",size:"small"},{default:t(()=>[...e[4]||(e[4]=[i("待开除",-1)])]),_:1})):l.enabled?(n(),m(c,{key:1,type:"success",size:"small"},{default:t(()=>[...e[5]||(e[5]=[i("正常",-1)])]),_:1})):(n(),m(c,{key:2,type:"info",size:"small"},{default:t(()=>[...e[6]||(e[6]=[i("禁用",-1)])]),_:1}))]),_:1}),a(d,{label:"分类",width:"160"},{default:t(({row:l})=>[H(l.id)?(n(),v("span",ue,"符合转正条件")):J(l.id)?(n(),v("span",me,"薪酬不达标")):(n(),v("span",ce,"-"))]),_:1})]),_:1},8,["data"])),[[C,x.value]])]),_:1}),a(R,{label:"转正评议",name:"promotion"},{default:t(()=>[o("div",fe,[a(g,{type:"primary",onClick:O,loading:V.value},{default:t(()=>[...e[7]||(e[7]=[i(" 触发转正评议 ",-1)])]),_:1},8,["loading"])]),o("div",pe,[o("div",null,[e[8]||(e[8]=o("h3",{class:"text-base font-medium text-gray-700 mb-2"},"符合转正条件的实习成员",-1)),E((n(),m(D,{data:p.value,stripe:"",size:"small"},{default:t(()=>[a(d,{prop:"username",label:"用户名"}),a(d,{prop:"role",label:"角色",width:"100"},{default:t(({row:l})=>[a(c,{size:"small"},{default:t(()=>[i(P(l.role),1)]),_:2},1024)]),_:1})]),_:1},8,["data"])),[[C,w.value]])]),o("div",null,[e[9]||(e[9]=o("h3",{class:"text-base font-medium text-gray-700 mb-2"},"薪酬不达标的正式成员",-1)),E((n(),m(D,{data:b.value,stripe:"",size:"small"},{default:t(()=>[a(d,{prop:"username",label:"用户名"}),a(d,{prop:"role",label:"角色",width:"100"},{default:t(({row:l})=>[a(c,{size:"small"},{default:t(()=>[i(P(l.role),1)]),_:2},1024)]),_:1})]),_:1},8,["data"])),[[C,w.value]])])]),p.value.length>0&&b.value.length>0?(n(),v("div",be,[e[13]||(e[13]=o("h3",{class:"text-base font-medium text-gray-700 mb-3"},"执行转正流转",-1)),o("div",ge,[o("div",null,[e[10]||(e[10]=o("label",{class:"block text-sm text-gray-600 mb-1"},"转正实习成员",-1)),a(F,{modelValue:r.internId,"onUpdate:modelValue":e[0]||(e[0]=l=>r.internId=l),placeholder:"选择实习成员",class:"w-48"},{default:t(()=>[(n(!0),v(U,null,j(p.value,l=>(n(),m(B,{key:l.id,label:l.username,value:l.id},null,8,["label","value"]))),128))]),_:1},8,["modelValue"])]),o("div",null,[e[11]||(e[11]=o("label",{class:"block text-sm text-gray-600 mb-1"},"替换正式成员",-1)),a(F,{modelValue:r.memberId,"onUpdate:modelValue":e[1]||(e[1]=l=>r.memberId=l),placeholder:"选择正式成员",class:"w-48"},{default:t(()=>[(n(!0),v(U,null,j(b.value,l=>(n(),m(B,{key:l.id,label:l.username,value:l.id},null,8,["label","value"]))),128))]),_:1},8,["modelValue"])]),a(g,{type:"success",onClick:Q,loading:h.value,disabled:!r.internId||!r.memberId},{default:t(()=>[...e[12]||(e[12]=[i(" 执行流转 ",-1)])]),_:1},8,["loading","disabled"])])])):ee("",!0)]),_:1}),a(R,{label:"待开除",name:"dismissal"},{default:t(()=>[o("div",ve,[a(g,{onClick:W,loading:M.value},{default:t(()=>[...e[14]||(e[14]=[i("标记待开除",-1)])]),_:1},8,["loading"]),a(g,{onClick:A,loading:I.value},{default:t(()=>[...e[15]||(e[15]=[i("刷新",-1)])]),_:1},8,["loading"])]),E((n(),m(D,{data:k.value,stripe:"",class:"w-full"},{default:t(()=>[a(d,{prop:"username",label:"用户名",width:"160"}),a(d,{prop:"role",label:"角色",width:"140"},{default:t(({row:l})=>[a(c,{size:"small"},{default:t(()=>[i(P(l.role),1)]),_:2},1024)]),_:1}),a(d,{label:"状态",width:"140"},{default:t(()=>[a(c,{type:"danger",size:"small"},{default:t(()=>[...e[16]||(e[16]=[i("待开除",-1)])]),_:1})]),_:1})]),_:1},8,["data"])),[[C,I.value]])]),_:1})]),_:1},8,["modelValue"])])}}});export{xe as default};
