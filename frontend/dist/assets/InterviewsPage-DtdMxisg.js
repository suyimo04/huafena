import{d as F,m as W,a7 as J,c as f,a as e,a6 as U,t as y,n as C,b as s,w as o,F as z,x as L,i as Q,j as x,E as A,r as p,o as i,f as g,a8 as X,v as M,s as B,C as K,D as H,y as Y}from"./index-Dmpy0hQc.js";import{i as j}from"./axios-DYop8cuN.js";import{c as Z}from"./application-J3Xs52zM.js";function ee(t,b){return j.post(`/interviews/${t}/message`,{message:b})}function te(t){return j.post(`/interviews/${t}/end`)}function se(t){return j.get(`/interviews/${t}`)}function q(t){return j.get(`/interviews/${t}/messages`)}function le(t){return j.get(`/interviews/${t}/report`)}function ne(t,b){return j.post(`/interviews/${t}/review`,b)}const oe={class:"interview-chat flex flex-col h-full"},ae={class:"chat-header flex items-center justify-between px-4 py-3 border-b border-gray-200 bg-white/80"},re={class:"flex items-center gap-4"},ie={key:0,class:"flex justify-start"},de={class:"chat-input flex items-center gap-2 px-4 py-3 border-t border-gray-200 bg-white/80"},ue=F({__name:"InterviewChat",props:{interviewId:{}},emits:["ended"],setup(t,{emit:b}){const _=t,k=b,n=x([]),d=x(""),a=x(!1),R=x(!1),r=x(!1),h=x(0),V=x(null);let N=null;function $(){l(),h.value=60,N=setInterval(()=>{h.value--,h.value<=0&&l()},1e3)}function l(){N&&(clearInterval(N),N=null),h.value=0}async function D(){await X(),V.value&&(V.value.scrollTop=V.value.scrollHeight)}async function P(){try{const v=await q(_.interviewId);n.value=v.data,await D(),n.value.length>0&&n.value[n.value.length-1].role!=="USER"&&$()}catch{}}async function c(){const v=d.value.trim();if(!(!v||a.value||r.value)){l(),d.value="",a.value=!0;try{const u=await ee(_.interviewId,v);n.value.push({id:Date.now(),interviewId:_.interviewId,role:"USER",content:v,timestamp:new Date().toISOString(),timeLimitSeconds:60}),n.value.push(u.data),await D(),$()}catch{A.error("发送失败，请重试")}finally{a.value=!1}}}async function m(){R.value=!0,l();try{await te(_.interviewId),r.value=!0,A.success("面试已结束"),k("ended")}catch{A.error("结束面试失败")}finally{R.value=!1}}return W(()=>_.interviewId,()=>{r.value=!1,n.value=[],P()},{immediate:!0}),J(()=>{l()}),(v,u)=>{const I=p("el-button"),T=p("el-input");return i(),f("div",oe,[e("div",ae,[u[2]||(u[2]=e("span",{class:"font-semibold text-gray-700"},"AI 面试对话",-1)),e("div",re,[h.value>0?(i(),f("span",{key:0,class:U(["countdown-timer text-sm font-mono px-3 py-1 rounded-full",h.value<=10?"bg-red-100 text-red-600":"bg-emerald-100 text-emerald-700"])}," ⏱ "+y(h.value)+"s ",3)):C("",!0),s(I,{type:"danger",size:"small",onClick:m,loading:R.value},{default:o(()=>[...u[1]||(u[1]=[g(" 结束面试 ",-1)])]),_:1},8,["loading"])])]),e("div",{ref_key:"messagesRef",ref:V,class:"messages-area flex-1 overflow-y-auto p-4 space-y-3"},[(i(!0),f(z,null,L(n.value,E=>(i(),f("div",{key:E.id,class:U(["message-bubble flex",E.role==="USER"?"justify-end":"justify-start"])},[e("div",{class:U(["max-w-[75%] px-4 py-2 rounded-xl text-sm leading-relaxed",E.role==="USER"?"bg-emerald-500 text-white rounded-br-sm":"bg-gray-100 text-gray-800 rounded-bl-sm"])},y(E.content),3)],2))),128)),a.value?(i(),f("div",ie,[...u[3]||(u[3]=[e("div",{class:"bg-gray-100 text-gray-500 px-4 py-2 rounded-xl rounded-bl-sm text-sm"}," AI 正在思考... ",-1)])])):C("",!0)],512),e("div",de,[s(T,{modelValue:d.value,"onUpdate:modelValue":u[0]||(u[0]=E=>d.value=E),placeholder:"输入你的回答...",disabled:a.value||r.value,onKeyup:Q(c,["enter"]),class:"flex-1"},null,8,["modelValue","disabled"]),s(I,{type:"primary",disabled:!d.value.trim()||a.value||r.value,loading:a.value,onClick:c},{default:o(()=>[...u[4]||(u[4]=[g(" 发送 ",-1)])]),_:1},8,["disabled","loading"])])])}}}),ce={class:"interview-report"},me={class:"mb-4 flex items-center justify-between"},ve={key:0,class:"space-y-4"},pe={class:"score-item"},fe={class:"flex justify-between text-sm text-gray-600 mb-1"},ge={class:"font-mono"},ye={class:"score-item"},be={class:"flex justify-between text-sm text-gray-600 mb-1"},_e={class:"font-mono"},we={class:"score-item"},xe={class:"flex justify-between text-sm text-gray-600 mb-1"},he={class:"font-mono"},Ie={class:"score-item total-score pt-2 border-t border-gray-200"},Ee={class:"flex justify-between text-sm font-semibold text-gray-800 mb-1"},ke={class:"font-mono text-base"},Re={key:0,class:"ai-comment mt-4 p-3 bg-gray-50 rounded-lg"},$e={class:"text-sm text-gray-600 leading-relaxed"},Se=F({__name:"InterviewReport",props:{report:{}},setup(t){const b=t,_=B(()=>{if(!b.report)return"";const d=b.report.totalScore;return d>=8?"建议通过":d>=6?"重点审查对话内容":"建议拒绝"}),k=B(()=>{if(!b.report)return"info";const d=b.report.totalScore;return d>=8?"success":d>=6?"warning":"danger"});function n(d){return d>=8?"#10b981":d>=6?"#f59e0b":"#ef4444"}return(d,a)=>{const R=p("el-tag"),r=p("el-progress"),h=p("el-empty");return i(),f("div",ce,[e("div",me,[a[0]||(a[0]=e("h3",{class:"text-lg font-semibold text-gray-800"},"多维评估报告",-1)),t.report?(i(),M(R,{key:0,type:k.value,size:"large",class:"recommendation-tag"},{default:o(()=>[g(y(_.value),1)]),_:1},8,["type"])):C("",!0)]),t.report?(i(),f("div",ve,[e("div",pe,[e("div",fe,[a[1]||(a[1]=e("span",null,"规则熟悉度",-1)),e("span",ge,y(t.report.ruleFamiliarity)+"/10",1)]),s(r,{percentage:t.report.ruleFamiliarity*10,color:n(t.report.ruleFamiliarity),"stroke-width":12,"show-text":!1},null,8,["percentage","color"])]),e("div",ye,[e("div",be,[a[2]||(a[2]=e("span",null,"沟通能力",-1)),e("span",_e,y(t.report.communicationScore)+"/10",1)]),s(r,{percentage:t.report.communicationScore*10,color:n(t.report.communicationScore),"stroke-width":12,"show-text":!1},null,8,["percentage","color"])]),e("div",we,[e("div",xe,[a[3]||(a[3]=e("span",null,"抗压能力",-1)),e("span",he,y(t.report.pressureScore)+"/10",1)]),s(r,{percentage:t.report.pressureScore*10,color:n(t.report.pressureScore),"stroke-width":12,"show-text":!1},null,8,["percentage","color"])]),e("div",Ie,[e("div",Ee,[a[4]||(a[4]=e("span",null,"总分",-1)),e("span",ke,y(t.report.totalScore)+"/10",1)]),s(r,{percentage:t.report.totalScore*10,color:n(t.report.totalScore),"stroke-width":16,"show-text":!1},null,8,["percentage","color"])]),t.report.aiComment?(i(),f("div",Re,[a[5]||(a[5]=e("div",{class:"text-sm font-medium text-gray-700 mb-1"},"AI 评语",-1)),e("div",$e,y(t.report.aiComment),1)])):C("",!0)])):(i(),M(h,{key:1,description:"暂无评估报告"}))])}}}),Ce={class:"interview-review flex flex-col h-full"},Ve={class:"flex items-center gap-2 px-4 py-3 border-b border-gray-200"},Ne={class:"text-gray-500"},Te={class:"flex-1 overflow-y-auto p-4 space-y-6"},De={class:"bg-white rounded-xl border border-gray-200 p-4 shadow-sm"},Me={class:"bg-white rounded-xl border border-gray-200 shadow-sm"},Ae={class:"messages-area max-h-80 overflow-y-auto p-4 space-y-3"},je={key:0,class:"review-form bg-white rounded-xl border border-gray-200 p-4 shadow-sm"},Pe={key:1,class:"bg-white rounded-xl border border-gray-200 p-4 shadow-sm"},Ue=F({__name:"InterviewReview",props:{interviewId:{}},emits:["back","reviewed"],setup(t,{emit:b}){const _=t,k=b,n=x(null),d=x([]),a=x(!1),R=x(!1),r=x({approved:null,comment:"",suggestedMentor:""});function h($){return $?$.replace("T"," ").substring(0,19):""}async function V(){a.value=!0;try{const[$,l]=await Promise.all([le(_.interviewId),q(_.interviewId)]);n.value=$.data,d.value=l.data}catch{A.error("加载面试数据失败")}finally{a.value=!1}}async function N(){if(r.value.approved!==null){R.value=!0;try{await ne(_.interviewId,{approved:r.value.approved,reviewComment:r.value.comment||void 0,suggestedMentor:r.value.suggestedMentor||void 0}),A.success("复审提交成功"),await V(),k("reviewed")}catch{A.error("复审提交失败")}finally{R.value=!1}}}return W(()=>_.interviewId,()=>{r.value={approved:null,comment:"",suggestedMentor:""},V()},{immediate:!0}),($,l)=>{var G;const D=p("el-button"),P=p("el-empty"),c=p("el-radio"),m=p("el-radio-group"),v=p("el-form-item"),u=p("el-input"),I=p("el-form"),T=p("el-tag"),E=p("el-descriptions-item"),w=p("el-descriptions"),O=H("loading");return i(),f("div",Ce,[e("div",Ve,[s(D,{text:"",onClick:l[0]||(l[0]=S=>$.$emit("back"))},{default:o(()=>[...l[4]||(l[4]=[g("← 返回列表",-1)])]),_:1}),e("span",Ne,"面试 #"+y(t.interviewId)+" 复审",1)]),K((i(),f("div",Te,[e("div",De,[s(Se,{report:n.value},null,8,["report"])]),e("div",Me,[l[5]||(l[5]=e("div",{class:"px-4 py-3 border-b border-gray-100 font-semibold text-gray-700"}," 对话记录 ",-1)),e("div",Ae,[(i(!0),f(z,null,L(d.value,S=>(i(),f("div",{key:S.id,class:U(["message-bubble flex",S.role==="USER"?"justify-end":"justify-start"])},[e("div",{class:U(["max-w-[75%] px-4 py-2 rounded-xl text-sm leading-relaxed",S.role==="USER"?"bg-emerald-500 text-white rounded-br-sm":"bg-gray-100 text-gray-800 rounded-bl-sm"])},y(S.content),3)],2))),128)),d.value.length===0?(i(),M(P,{key:0,description:"暂无对话记录"})):C("",!0)])]),(G=n.value)!=null&&G.reviewedAt?(i(),f("div",Pe,[l[10]||(l[10]=e("h3",{class:"text-lg font-semibold text-gray-800 mb-2"},"复审结果",-1)),s(w,{column:1,border:""},{default:o(()=>[s(E,{label:"结果"},{default:o(()=>[s(T,{type:n.value.manualApproved?"success":"danger"},{default:o(()=>[g(y(n.value.manualApproved?"通过":"拒绝"),1)]),_:1},8,["type"])]),_:1}),s(E,{label:"评语"},{default:o(()=>[g(y(n.value.reviewerComment||"无"),1)]),_:1}),s(E,{label:"建议导师"},{default:o(()=>[g(y(n.value.suggestedMentor||"无"),1)]),_:1}),s(E,{label:"复审时间"},{default:o(()=>[g(y(h(n.value.reviewedAt)),1)]),_:1})]),_:1})])):(i(),f("div",je,[l[9]||(l[9]=e("h3",{class:"text-lg font-semibold text-gray-800 mb-4"},"复审表单",-1)),s(I,{model:r.value,"label-position":"top"},{default:o(()=>[s(v,{label:"复审结果"},{default:o(()=>[s(m,{modelValue:r.value.approved,"onUpdate:modelValue":l[1]||(l[1]=S=>r.value.approved=S)},{default:o(()=>[s(c,{value:!0},{default:o(()=>[...l[6]||(l[6]=[g("通过",-1)])]),_:1}),s(c,{value:!1},{default:o(()=>[...l[7]||(l[7]=[g("拒绝",-1)])]),_:1})]),_:1},8,["modelValue"])]),_:1}),s(v,{label:"复审评语"},{default:o(()=>[s(u,{modelValue:r.value.comment,"onUpdate:modelValue":l[2]||(l[2]=S=>r.value.comment=S),type:"textarea",rows:3,placeholder:"请输入复审评语..."},null,8,["modelValue"])]),_:1}),s(v,{label:"建议导师"},{default:o(()=>[s(u,{modelValue:r.value.suggestedMentor,"onUpdate:modelValue":l[3]||(l[3]=S=>r.value.suggestedMentor=S),placeholder:"请输入建议的实习导师..."},null,8,["modelValue"])]),_:1}),s(v,null,{default:o(()=>[s(D,{type:"primary",loading:R.value,disabled:r.value.approved===null,onClick:N},{default:o(()=>[...l[8]||(l[8]=[g(" 提交复审 ",-1)])]),_:1},8,["loading","disabled"])]),_:1})]),_:1},8,["model"])]))])),[[O,a.value]])])}}}),Oe={class:"p-6"},Fe={key:0},Ge={key:1,class:"chat-container bg-white rounded-xl border border-gray-200 shadow-sm",style:{height:"70vh"}},Be={class:"flex items-center gap-2 px-4 py-2 border-b border-gray-100"},We={key:2,class:"bg-white rounded-xl border border-gray-200 shadow-sm",style:{"min-height":"70vh"}},He=F({__name:"InterviewsPage",setup(t){const b=x([]),_=x(!1),k=x(null),n=x(null),d={NOT_STARTED:{label:"未开始",type:"info"},IN_PROGRESS:{label:"进行中",type:"warning"},COMPLETED:{label:"已完成",type:"success"},PENDING_REVIEW:{label:"待复审",type:""},REVIEWED:{label:"已复审",type:"success"}};function a(c){var m;return((m=d[c])==null?void 0:m.label)??c}function R(c){var m;return((m=d[c])==null?void 0:m.type)??"info"}function r(c){return c?c.replace("T"," ").substring(0,19):""}async function h(){_.value=!0;try{const v=((await Z()).data||[]).filter(I=>["AI_INTERVIEW_IN_PROGRESS","PENDING_REVIEW","INTERN_OFFERED"].includes(I.status)),u=[];for(const I of v)try{const T=await se(I.id);T.data&&u.push(T.data)}catch{}b.value=u}catch{b.value=[]}finally{_.value=!1}}function V(c){k.value=c,n.value=null}function N(){k.value=null,h()}function $(c){n.value=c,k.value=null}function l(){n.value=null,h()}function D(){}function P(){}return Y(h),(c,m)=>{const v=p("el-table-column"),u=p("el-tag"),I=p("el-button"),T=p("el-table"),E=H("loading");return i(),f("div",Oe,[m[3]||(m[3]=e("h2",{class:"text-xl font-semibold text-gray-800 mb-4"},"AI 面试",-1)),!k.value&&!n.value?(i(),f("div",Fe,[K((i(),M(T,{data:b.value,stripe:"",class:"w-full"},{default:o(()=>[s(v,{prop:"id",label:"面试ID",width:"80"}),s(v,{prop:"applicationId",label:"申请ID",width:"80"}),s(v,{label:"状态",width:"140"},{default:o(({row:w})=>[s(u,{type:R(w.status)},{default:o(()=>[g(y(a(w.status)),1)]),_:2},1032,["type"])]),_:1}),s(v,{label:"创建时间",width:"180"},{default:o(({row:w})=>[g(y(r(w.createdAt)),1)]),_:1}),s(v,{label:"操作"},{default:o(({row:w})=>[w.status==="IN_PROGRESS"?(i(),M(I,{key:0,type:"primary",size:"small",onClick:O=>V(w.id)},{default:o(()=>[...m[0]||(m[0]=[g(" 继续面试 ",-1)])]),_:1},8,["onClick"])):C("",!0),w.status==="PENDING_REVIEW"||w.status==="REVIEWED"||w.status==="COMPLETED"?(i(),M(I,{key:1,size:"small",type:"warning",onClick:O=>$(w.id)},{default:o(()=>[g(y(w.status==="PENDING_REVIEW"?"复审":"查看报告"),1)]),_:2},1032,["onClick"])):C("",!0),w.status!=="IN_PROGRESS"?(i(),M(I,{key:2,size:"small",onClick:O=>V(w.id)},{default:o(()=>[...m[1]||(m[1]=[g(" 查看记录 ",-1)])]),_:1},8,["onClick"])):C("",!0)]),_:1})]),_:1},8,["data"])),[[E,_.value]])])):C("",!0),k.value?(i(),f("div",Ge,[e("div",Be,[s(I,{text:"",onClick:N},{default:o(()=>[...m[2]||(m[2]=[g("← 返回列表",-1)])]),_:1})]),s(ue,{"interview-id":k.value,onEnded:D,style:{height:"calc(100% - 45px)"}},null,8,["interview-id"])])):C("",!0),n.value?(i(),f("div",We,[s(Ue,{"interview-id":n.value,onBack:l,onReviewed:P},null,8,["interview-id"])])):C("",!0)])}}});export{He as default};
