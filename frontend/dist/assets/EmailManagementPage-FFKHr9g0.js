import{i as b}from"./axios-DYop8cuN.js";import{d as J,y as K,c as O,a as r,b as t,w as s,j as m,r as n,k as M,o as Q,f as u,t as g,E as h,_ as W}from"./index-Dmpy0hQc.js";function X(){return b.get("/emails/templates")}function Y(i=0,c=20){return b.get("/emails/logs",{params:{page:i,size:c}})}function Z(){return b.get("/emails/config")}function ee(i){return b.put("/emails/config",i)}const te={class:"email-management"},ae={class:"card"},le={class:"card"},se={class:"preview-section"},oe={class:"preview-value"},ne={class:"preview-section"},re=["innerHTML"],pe={class:"card"},me={class:"pagination-wrapper"},H=20,de=J({__name:"EmailManagementPage",setup(i){const c=m("config"),T=m(),v=m(!1),l=M({smtpHost:"",smtpPort:465,smtpUsername:"",smtpPassword:"",senderName:"",sslEnabled:!0}),x={smtpHost:[{required:!0,message:"SMTP 主机不能为空",trigger:"blur"}],smtpPort:[{required:!0,message:"SMTP 端口不能为空",trigger:"blur"}],smtpUsername:[{required:!0,message:"用户名不能为空",trigger:"blur"}]};async function k(){try{const e=(await Z()).data;l.smtpHost=e.smtpHost||"",l.smtpPort=e.smtpPort||465,l.smtpUsername=e.smtpUsername||"",l.smtpPassword=e.smtpPasswordEncrypted||"",l.senderName=e.senderName||"",l.sslEnabled=e.sslEnabled??!0}catch{}}async function L(){var e;if(await((e=T.value)==null?void 0:e.validate().catch(()=>!1))){v.value=!0;try{await ee({smtpHost:l.smtpHost,smtpPort:l.smtpPort,smtpUsername:l.smtpUsername,smtpPassword:l.smtpPassword||null,senderName:l.senderName,sslEnabled:l.sslEnabled}),h.success("SMTP 配置已保存")}catch{h.error("保存失败")}finally{v.value=!1}}}const V=m([]),w=m(!1),f=M({subjectTemplate:"",bodyTemplate:""});async function j(){try{const o=await X();V.value=o.data}catch{}}function D(o){f.subjectTemplate=o.subjectTemplate,f.bodyTemplate=o.bodyTemplate,w.value=!0}const E=m([]),P=m(1),U=m(0);async function N(){try{const o=await Y(P.value-1,H);E.value=o.data.content,U.value=o.data.totalElements}catch{}}function q(o){switch(o){case"SENT":return"success";case"FAILED":return"danger";case"PENDING":return"warning";default:return"info"}}function F(o){switch(o){case"SENT":return"已发送";case"FAILED":return"失败";case"PENDING":return"待发送";default:return o}}return K(()=>{k(),j(),N()}),(o,e)=>{const _=n("el-input"),d=n("el-form-item"),I=n("el-input-number"),A=n("el-switch"),C=n("el-button"),R=n("el-form"),y=n("el-tab-pane"),p=n("el-table-column"),S=n("el-table"),z=n("el-dialog"),B=n("el-tag"),G=n("el-pagination"),$=n("el-tabs");return Q(),O("div",te,[e[13]||(e[13]=r("h2",{class:"page-title"},"邮件管理",-1)),t($,{modelValue:c.value,"onUpdate:modelValue":e[8]||(e[8]=a=>c.value=a),class:"email-tabs"},{default:s(()=>[t(y,{label:"SMTP 配置",name:"config"},{default:s(()=>[r("div",ae,[t(R,{ref_key:"configFormRef",ref:T,model:l,rules:x,"label-width":"120px",class:"config-form"},{default:s(()=>[t(d,{label:"SMTP 主机",prop:"smtpHost"},{default:s(()=>[t(_,{modelValue:l.smtpHost,"onUpdate:modelValue":e[0]||(e[0]=a=>l.smtpHost=a),placeholder:"如 smtp.qq.com"},null,8,["modelValue"])]),_:1}),t(d,{label:"SMTP 端口",prop:"smtpPort"},{default:s(()=>[t(I,{modelValue:l.smtpPort,"onUpdate:modelValue":e[1]||(e[1]=a=>l.smtpPort=a),min:1,max:65535},null,8,["modelValue"])]),_:1}),t(d,{label:"用户名",prop:"smtpUsername"},{default:s(()=>[t(_,{modelValue:l.smtpUsername,"onUpdate:modelValue":e[2]||(e[2]=a=>l.smtpUsername=a),placeholder:"SMTP 登录用户名"},null,8,["modelValue"])]),_:1}),t(d,{label:"密码",prop:"smtpPassword"},{default:s(()=>[t(_,{modelValue:l.smtpPassword,"onUpdate:modelValue":e[3]||(e[3]=a=>l.smtpPassword=a),type:"password","show-password":"",placeholder:"留空则不修改密码"},null,8,["modelValue"])]),_:1}),t(d,{label:"发件人名称",prop:"senderName"},{default:s(()=>[t(_,{modelValue:l.senderName,"onUpdate:modelValue":e[4]||(e[4]=a=>l.senderName=a),placeholder:"如 花粉管理系统"},null,8,["modelValue"])]),_:1}),t(d,{label:"启用 SSL"},{default:s(()=>[t(A,{modelValue:l.sslEnabled,"onUpdate:modelValue":e[5]||(e[5]=a=>l.sslEnabled=a)},null,8,["modelValue"])]),_:1}),t(d,null,{default:s(()=>[t(C,{type:"primary",loading:v.value,onClick:L},{default:s(()=>[...e[9]||(e[9]=[u(" 保存配置 ",-1)])]),_:1},8,["loading"])]),_:1})]),_:1},8,["model"])])]),_:1}),t(y,{label:"邮件模板",name:"templates"},{default:s(()=>[r("div",le,[t(S,{data:V.value,stripe:""},{default:s(()=>[t(p,{prop:"templateCode",label:"模板编码",width:"240"}),t(p,{prop:"subjectTemplate",label:"邮件主题模板"}),t(p,{label:"操作",width:"100"},{default:s(({row:a})=>[t(C,{type:"primary",link:"",onClick:ue=>D(a)},{default:s(()=>[...e[10]||(e[10]=[u("预览",-1)])]),_:1},8,["onClick"])]),_:1})]),_:1},8,["data"])]),t(z,{modelValue:w.value,"onUpdate:modelValue":e[6]||(e[6]=a=>w.value=a),title:"模板预览",width:"600px"},{default:s(()=>[r("div",se,[e[11]||(e[11]=r("p",{class:"preview-label"},"主题：",-1)),r("p",oe,g(f.subjectTemplate),1)]),r("div",ne,[e[12]||(e[12]=r("p",{class:"preview-label"},"正文：",-1)),r("div",{class:"preview-body",innerHTML:f.bodyTemplate},null,8,re)])]),_:1},8,["modelValue"])]),_:1}),t(y,{label:"发送日志",name:"logs"},{default:s(()=>[r("div",pe,[t(S,{data:E.value,stripe:""},{default:s(()=>[t(p,{prop:"recipient",label:"收件人",width:"200"}),t(p,{prop:"subject",label:"主题","show-overflow-tooltip":""}),t(p,{prop:"templateCode",label:"模板",width:"200"},{default:s(({row:a})=>[u(g(a.templateCode||"-"),1)]),_:1}),t(p,{prop:"status",label:"状态",width:"100"},{default:s(({row:a})=>[t(B,{type:q(a.status),size:"small"},{default:s(()=>[u(g(F(a.status)),1)]),_:2},1032,["type"])]),_:1}),t(p,{prop:"retryCount",label:"重试",width:"70"}),t(p,{prop:"failReason",label:"失败原因","show-overflow-tooltip":""}),t(p,{label:"时间",width:"170"},{default:s(({row:a})=>[u(g(a.sentAt||a.createdAt),1)]),_:1})]),_:1},8,["data"]),r("div",me,[t(G,{"current-page":P.value,"onUpdate:currentPage":e[7]||(e[7]=a=>P.value=a),"page-size":H,total:U.value,layout:"total, prev, pager, next",onCurrentChange:N},null,8,["current-page","total"])])])]),_:1})]),_:1},8,["modelValue"])])}}}),fe=W(de,[["__scopeId","data-v-c5e474ef"]]);export{fe as default};
