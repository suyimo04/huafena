# 需求文档：工资计算规则系统

## 简介

本需求文档定义花粉小组管理系统中工资计算规则的完整增强方案。现有系统已具备基础薪资计算功能（硬编码薪酬池、简单的积分汇总），本次增强将实现：各积分维度的详细计算规则、签到奖惩分级表、薪酬池动态分配机制、前端可配置参数管理，以及动态成员流转机制的阈值可配置化。核心原则为"各维度手动录入数据，总积分、基础积分、奖励积分、迷你币按规则自动计算"。

## 术语表

- **薪酬池（Salary_Pool）**：每月固定的迷你币总额，默认 2000 迷你币（对应 1000 积分），仅在正式成员之间分配
- **迷你币（Mini_Coin）**：薪酬计量单位，1 积分 = 2 迷你币
- **正式成员（Formal_Member）**：参与薪酬池分配的成员，包含 1 名副组长和 4 名正式成员，共 5 人
- **实习成员（Intern_Member）**：不参与薪酬分配，仅记录积分，积分作为转正依据
- **基础积分（Base_Points）**：由基础职责项（社群活跃度、签到/签退、处理违规、完成任务、发布公告）汇总得出的积分
- **奖励积分（Bonus_Points）**：由卓越贡献项（举办活动、生日福利、月度优秀评议）汇总得出的积分
- **总积分（Total_Points）**：基础积分 + 奖励积分
- **计算引擎（Calculation_Engine）**：后端自动计算总积分、基础积分、奖励积分和迷你币的服务模块
- **配置管理器（Config_Manager）**：管理薪酬池大小、成员数量、积分范围、阈值等可配置参数的模块
- **签到奖惩表（Checkin_Reward_Table）**：根据月度签到次数分级计算签到积分的对照表
- **薪酬明细表（Salary_Report）**：展示每位成员详细收入和积分构成的报表

## 需求

### 需求 1：薪酬池与分配参数可配置化

**用户故事：** 作为管理员，我希望在前端配置薪酬池大小、正式成员数量、个人薪酬浮动范围等参数，以便灵活调整薪酬分配策略而无需修改代码。

#### 验收标准

1. THE Config_Manager SHALL 提供以下可配置参数：薪酬池总额（默认 2000 迷你币）、正式成员数量（默认 5）、基准分配额（默认 400 迷你币/人）、个人最低迷你币（默认 200）、个人最高迷你币（默认 400）
2. WHEN 管理员修改配置参数时，THE Config_Manager SHALL 持久化保存配置并立即生效于后续计算
3. WHEN 配置参数不存在时，THE Config_Manager SHALL 使用预定义的默认值进行计算
4. IF 管理员设置的个人最低迷你币大于个人最高迷你币，THEN THE Config_Manager SHALL 拒绝保存并返回参数校验错误信息
5. IF 管理员设置的基准分配额乘以正式成员数量超过薪酬池总额，THEN THE Config_Manager SHALL 拒绝保存并返回参数一致性错误信息

### 需求 2：积分维度手动录入与分类

**用户故事：** 作为管理员，我希望按积分维度手动录入各成员的积分数据，以便系统根据录入数据自动计算汇总结果。

#### 验收标准

1. THE Calculation_Engine SHALL 支持以下基础职责积分项录入：社群活跃度（0-100 分/月）、签到/签退（由签到次数自动计算）、处理成员违规（3 分/次）、完成任务（1-10 分/次）、发布群公告（5 分/次）
2. THE Calculation_Engine SHALL 支持以下卓越贡献积分项录入：举办群内活动（5-25 分/次）、当月生日福利（25 分/次）、月度优秀评议（10-30 分/月）
3. WHEN 管理员录入各维度积分数据后，THE Calculation_Engine SHALL 自动汇总基础积分为所有基础职责项之和
4. WHEN 管理员录入各维度积分数据后，THE Calculation_Engine SHALL 自动汇总奖励积分为所有卓越贡献项之和
5. WHEN 基础积分和奖励积分计算完成后，THE Calculation_Engine SHALL 自动计算总积分为基础积分加奖励积分
6. IF 录入的积分值超出该维度允许的范围，THEN THE Calculation_Engine SHALL 拒绝录入并提示具体的合法范围

### 需求 3：签到奖惩分级计算

**用户故事：** 作为管理员，我希望系统根据月度签到次数自动计算签到积分，以便准确反映成员的出勤表现。

#### 验收标准

1. WHEN 月度签到次数小于 20 次时，THE Calculation_Engine SHALL 计算签到积分为 -20 分（-40 迷你币），等级标记为"不合格"
2. WHEN 月度签到次数在 20 至 29 次之间时，THE Calculation_Engine SHALL 计算签到积分为 -10 分（-20 迷你币），等级标记为"需改进"
3. WHEN 月度签到次数在 30 至 39 次之间时，THE Calculation_Engine SHALL 计算签到积分为 0 分（0 迷你币），等级标记为"合格"
4. WHEN 月度签到次数在 40 至 49 次之间时，THE Calculation_Engine SHALL 计算签到积分为 +30 分（+60 迷你币），等级标记为"良好"
5. WHEN 月度签到次数大于等于 50 次时，THE Calculation_Engine SHALL 计算签到积分为 +50 分（+100 迷你币），等级标记为"优秀"
6. THE Checkin_Reward_Table SHALL 支持通过 Config_Manager 配置签到次数阈值和对应积分值

### 需求 4：薪酬池分配与调剂机制

**用户故事：** 作为管理员，我希望系统在薪酬池总额内按绩效比例分配薪酬，并将贡献较少成员的额度调剂给贡献卓越的成员，以便实现公平合理的薪酬分配。

#### 验收标准

1. WHEN 执行薪酬计算时，THE Calculation_Engine SHALL 将每位正式成员的总积分乘以 2 转换为原始迷你币
2. WHEN 所有正式成员的原始迷你币总和超过薪酬池总额时，THE Calculation_Engine SHALL 按各成员原始迷你币占比等比例缩减至薪酬池总额
3. WHEN 所有正式成员的原始迷你币总和未超过薪酬池总额时，THE Calculation_Engine SHALL 保留各成员原始迷你币不变
4. WHEN 薪酬池分配完成后，THE Calculation_Engine SHALL 确保每位正式成员的最终迷你币在配置的最低值和最高值之间
5. WHEN 某成员的分配额超过个人最高值时，THE Calculation_Engine SHALL 将超出部分调剂给未达最高值的成员
6. THE Calculation_Engine SHALL 确保所有正式成员最终迷你币总和不超过薪酬池总额

### 需求 5：迷你币自动计算

**用户故事：** 作为管理员，我希望系统根据积分自动计算迷你币，以便减少手动计算错误。

#### 验收标准

1. THE Calculation_Engine SHALL 按照 1 积分等于 2 迷你币的换算比例计算迷你币
2. WHEN 总积分发生变化时，THE Calculation_Engine SHALL 自动重新计算对应的迷你币数值
3. THE Calculation_Engine SHALL 将换算比例作为可配置参数存储在 Config_Manager 中

### 需求 6：动态流转阈值可配置化

**用户故事：** 作为管理员，我希望在前端配置转正条件和开除条件的阈值，以便灵活调整成员流转策略。

#### 验收标准

1. THE Config_Manager SHALL 提供以下流转阈值配置：实习成员转正积分阈值（默认 100 分）、正式成员降级薪酬阈值（默认 150 分对应 300 迷你币）、降级检测连续月数（默认 2 个月）、实习成员开除积分阈值（默认 100 分）、开除检测连续月数（默认 2 个月）
2. WHEN 流转阈值配置更新后，THE Calculation_Engine SHALL 在下次流转检测时使用新的阈值
3. IF 管理员设置的转正积分阈值为负数，THEN THE Config_Manager SHALL 拒绝保存并返回参数校验错误信息

### 需求 7：薪酬明细报表生成

**用户故事：** 作为管理员，我希望系统生成包含每人各维度积分明细的薪酬报表，以便进行薪酬公示和存档。

#### 验收标准

1. WHEN 管理员请求生成薪酬报表时，THE Salary_Report SHALL 展示每位正式成员的各积分维度明细（社群活跃度、签到积分、违规处理、任务完成、公告发布、活动举办、生日福利、月度评议）
2. WHEN 生成薪酬报表时，THE Salary_Report SHALL 展示每位成员的基础积分、奖励积分、总积分和最终迷你币
3. WHEN 生成薪酬报表时，THE Salary_Report SHALL 展示薪酬池总额、已分配总额和剩余额度
4. THE Salary_Report SHALL 支持存档操作，将当期薪酬数据标记为已归档并记录归档时间

### 需求 8：前端积分录入与配置界面

**用户故事：** 作为管理员，我希望在前端界面中按维度录入积分数据并管理配置参数，以便高效完成薪酬管理工作。

#### 验收标准

1. WHEN 管理员打开薪资管理页面时，THE SalaryPage SHALL 展示所有正式成员的各积分维度录入列，包含基础职责项和卓越贡献项
2. WHEN 管理员修改任意积分维度的值后，THE SalaryPage SHALL 实时自动计算并展示该成员的基础积分、奖励积分、总积分和迷你币
3. WHEN 管理员打开配置面板时，THE SalaryPage SHALL 展示所有可配置参数（薪酬池、成员数、浮动范围、签到阈值、流转阈值）并支持编辑保存
4. THE SalaryPage SHALL 对实习成员仅展示积分记录，不展示薪酬相关列
5. IF 录入值超出允许范围，THEN THE SalaryPage SHALL 在对应单元格显示红色边框和错误提示
